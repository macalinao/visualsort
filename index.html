<!doctype html>
<html>
<head>
	<title>Sorting algorithm visualization</title>
	<style type="text/css">
		/* Enjoy my beautiful CSS! */
		html {
			margin: 0px;
			height: 100%;
		}

		body {
			background-color: #cccccc;
			margin: 0px;
			height: 100%;
			font-family: Tahoma, Helvetica, Verdana, Arial;
		}

		#container {
			background-color: #ffffff;
			margin: 0px auto;
			min-height: 100%;
			height: auto !important;
			padding: 10px;
			width: 800px;
			text-align: center;
		}

		#intro {
			margin-bottom: 10px;
		}

		#controls {
			padding: 5px;
			height: 150px;
		}

		#instructions {
			width: 20%;
			height: 100%;
			text-align: left;
			float: left;
		}

		#settings {
			width: 60%;
			height: 100%;
			padding-top: 15px;
			float: left;
		}

		#sortbutton {
			width: 20%;
			height: 100%;
			float: left;
		}

		#credits {
			margin-top: 10px;
		}

		h3 {
			line-height: 15px;
			font-size: 20px;
		}

		label {
			float: left;
			text-align: right;
			width: 140px;
		}

		select, input {
			margin-left: 50px;
		}

		.sgroup {
			text-align: left;
			margin-bottom: 18px;
		}

		.sgroup::before, .sgroup::after {
			display: table;
			content: "";
		}

		.sgroup::after {
			clear: both;
		}

		small {
			font-size: 13px;
		}

		.sortbutton {
			margin: 0px;
			-moz-box-shadow:inset 0px 0px 0px 0px #f29c93;
			-webkit-box-shadow:inset 0px 0px 0px 0px #f29c93;
			box-shadow:inset 0px 0px 0px 0px #f29c93;
			background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #fe1a00), color-stop(1, #ce0100) );
			background:-moz-linear-gradient( center top, #fe1a00 5%, #ce0100 100% );
			filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#fe1a00', endColorstr='#ce0100');
			background-color:#fe1a00;
			-moz-border-radius:7px;
			-webkit-border-radius:7px;
			border-radius:7px;
			border:1px solid #d83526;
			display:inline-block;
			color:#ffffff;
			font-family:arial;
			font-size:28px;
			font-weight:bold;
			padding:17px 37px;
			text-decoration:none;
			text-shadow:1px 1px 0px #b23e35;
		}.sortbutton:hover {
			background:-webkit-gradient( linear, left top, left bottom, color-stop(0.05, #ce0100), color-stop(1, #fe1a00) );
			background:-moz-linear-gradient( center top, #ce0100 5%, #fe1a00 100% );
			filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#ce0100', endColorstr='#fe1a00');
			background-color:#ce0100;
		}.sortbutton:active {
			position:relative;
			top:1px;
		}
		/* This imageless css button was generated by CSSButtonGenerator.com */
	</style>
</head>
<body>
	<div id="container">
		<div id="intro">
			<h1>Visualization of sorting algorithms</h1>
		</div>
		<canvas id="sort" width="800" height="300">
			Unfortunately, it looks like canvas is not supported in your browser.
		</canvas>
		<div id="controls">
			<form id="controlsForm">
				<div id="instructions">
					<h3>Instructions:</h3>
					<small>Select a sorting algorithm, sample set, and the size of the set to the right then press 'Sort'.</small>
				</div>
				<div id="settings">
					<div class="sgroup">
						<label>Algorithm</label>
						<select id="algorithm">
							<option value="quick">Quicksort</option>
							<option value="selection">Selection Sort</option>
							<option value="insertion">Insertion Sort</option>
							<option value="bubble">Bubble Sort</option>
							<option value="bogo">Bogosort (BEWARE)</option>
						</select>
					</div>

					<div class="sgroup">
						<label>Set type</label>
						<select id="set">
							<option value="random">Random</option>
							<option value="sorted">Sorted</option>
							<option value="reverse">Reverse</option>
						</select>
					</div>

					<div class="sgroup">
						<label>Amount</label>
						<input id="amount" type="text" placeholder="Enter a number here" />
					</div>

					<div class="sgroup">
						<label>ms per tick</label>
						<input id="ms" type="text" placeholder="Smaller is faster" />
					</div>
				</div>
				<div id="rightdiv">
					<div id="buttondiv">
						<input id="thebutton" class="sortbutton" type="submit" value="Sort" />
					</div>
					<div id="credits">
            Made by <a href="https://github.com/simplyianm">Ian Macalinao</a> in an attempt to learn sorting algorithms. <a href="https://github.com/simplyianm/visualsort">View on GitHub</a>
					</div>
				</div>
			</form>
		</div>
	</div>
	<script type="text/javascript" src="//code.jquery.com/jquery-2.1.1.min.js"></script>
	<script type="text/javascript">
		Array.prototype.swap = function swap(a, b) {
			// console.log("swapping " + a + " (" + this[a] + ") with " + b + " (" + this[b] + ")");

			var swap = this[b];
			this[b] = this[a];
			this[a] = swap;
		};

		$(document).ready(function() {
			$("#controlsForm").submit(function() {
				var algorithmName = $("#algorithm").val();
				var algorithm = sorts[algorithmName];

				var setTypeName = $("#set").val();
				var setType = arrayGenerators[setTypeName];

				var amountText = $("#amount").val();
				var amount = parseInt(amountText);

				var msText = $("#ms").val();
				var ms = parseInt(msText);

				draws = [];
				begin(algorithm, setType(amount), ms);

				return false;
			});

			function begin(Algorithm, arr, ms) {
				function queueDraw() {
					setTimeout(function() {
						var func = draws.shift();
						if (func) {
							func();
							queueDraw();
						}
					}, ms);
				};
				queueDraw();
				(new Algorithm(arr)).sort();
			}


			var canvas = $("#sort")[0];
			var cx = canvas.getContext("2d");

			var max = 100;
			var pointerHeight = 30;
			var scale = (canvas.height - pointerHeight) / max;

			var colorNormal = "#000000";
			var colorSelected = "#0000ff";
			var colorPointer = "#ff0000";

			var spacing = 1;

			var draws = [];

			function queueDraw(arr, selected, swap) {
				draws.push(function() {
					drawArray(arr, selected, swap);
				});
			}

			function drawArray(arr, selected, swap) {
				var columnWidth = canvas.width / arr.length;
				cx.clearRect(0, 0, canvas.width, canvas.height);
				cx.fillStyle = colorNormal;

				for (var i = 0; i < arr.length; i++) {
					var colHeight = arr[i] * scale;
					var isSwap = swap.indexOf(i) != -1;
					if (isSwap) {
						cx.fillStyle = colorSelected;
					}
					cx.fillRect((i * columnWidth) + spacing, canvas.height - colHeight - pointerHeight, columnWidth - spacing, colHeight);
					if (isSwap) {
						cx.fillStyle = colorNormal;
					}
				}

				// Draw pointer
				cx.fillStyle = colorPointer;
				for (var k = 0; k < selected.length; k++) {
					var pos = selected[k];
					cx.beginPath();
					cx.moveTo(pos * columnWidth, canvas.height);
					cx.lineTo((pos + 1) * columnWidth, canvas.height);
					cx.lineTo(((pos + 1) * columnWidth) - (columnWidth / 2), canvas.height - pointerHeight);
					cx.fill();
				}
			}

			//////////////
			// ARRAYS
			//////////////

			var arrayGenerators = {};
			arrayGenerators.sorted = function(amt) {
				var ret = [];
				var interval = max / amt;
				for (var i = 1; i <= 100; i += interval) {
					ret.push(i);
				}
				return ret;
			};

			arrayGenerators.reverse = function(amt) {
				var ret = [];
				var interval = max / amt;
				for (var i = 100; i >= 1; i -= interval) {
					ret.push(i);
				}
				return ret;
			};

			arrayGenerators.random = function(amt) {
				var arr = arrayGenerators.sorted(amt);
				fisherYates(arr);
				return arr;
			};

			// http://stackoverflow.com/questions/2450954/how-to-randomize-a-javascript-array
			function fisherYates ( myArray ) {
				var i = myArray.length;
				if ( i == 0 ) return false;
				while ( --i ) {
					var j = Math.floor( Math.random() * ( i + 1 ) );
					var tempi = myArray[i];
					var tempj = myArray[j];
					myArray[i] = tempj;
					myArray[j] = tempi;
				}
			}

			//////////////
			// SORTS
			//////////////
			function BubbleSort(arr) {
				if (false === (this instanceof BubbleSort)) {
					return new BubbleSort(arr);
				}

				this.arr = arr;

				this.sort = function() {
					for (var i = 0; i < this.arr.length; i++) {
						var swapped = false;
						for (var j = 0; j < this.arr.length - i; j++) {
							if (this.arr[j] > this.arr[j + 1]) {
								var temp = this.arr[j + 1];
								this.arr[j + 1] = this.arr[j];
								this.arr[j] = temp;
								queueDraw(this.arr.slice(), [j], [j, j + 1]);
								swapped = true;
							} else {
								queueDraw(this.arr.slice(), [j], []);
							}
						}
						if (!swapped) {
							return;
						}
					}
				};
			}

			function Quicksort(arr) {
				if (false === (this instanceof Quicksort)) {
					return new Quicksort(arr);
				}
				this.arr = arr;

				this.qs = function(left, right) {
					if (left < right) {
						var pivot = this.arr[Math.round((left + right) / 2)];

						var l = left;
						var r = right;

						do {
							while (this.arr[left] < pivot) {
								left++;
								queueDraw(this.arr.slice(), [left], []);
							}

							while (this.arr[right] > pivot) {
								right--;
								queueDraw(this.arr.slice(), [right], []);
							}

							if (left <= right) {
								arr.swap(left++, right--);
								queueDraw(this.arr.slice(), [left, right], [left, right]);
							}
						} while (left <= right);

						this.qs(l, right);
						this.qs(left, r);
					}
				}

				this.sort = function() {
					this.qs(0, this.arr.length - 1);
				}
			}

			function SelectionSort(arr) {
				if (false === (this instanceof SelectionSort)) {
					return new SelectionSort(arr);
				}
				this.arr = arr;

				this.sort = function() {
					for (var i = 0; i < this.arr.length - 1; i++) {
						var min = i;
						for (var j = i + 1; j < this.arr.length; j++) {
							queueDraw(this.arr.slice(), [j], []);
							if (this.arr[j] < this.arr[min]) {
								min = j;
							}
						}

						this.arr.swap(i, min);
						queueDraw(this.arr.slice(), [i, j], [i, j]);
					}
				}
			}

			function InsertionSort(arr) {
				if (false === (this instanceof InsertionSort)) {
					return new InsertionSort(arr);
				}
				this.arr = arr;

				this.sort = function() {
					for (var i = 1; i < this.arr.length; i++) {
						var item = this.arr[i];
						queueDraw(this.arr.slice(), [i], []);
						var iHole = i;

						while (iHole > 0 && this.arr[iHole - 1] > item) {
							this.arr[iHole] = this.arr[iHole - 1];
							queueDraw(this.arr.slice(), [iHole - 1], [iHole, iHole - 1]);
							iHole--;
						}

						this.arr[iHole] = item;
						queueDraw(this.arr.slice(), [iHole], [iHole]);
					}
				}
			}

			function MergeSort(arr) {
				if (false === (this instanceof MergeSort)) {
					return new MergeSort(arr);
				}
				this.arr = arr;

				this.sort = function(arr) {
					var left = [];
					var right = [];
					var result = [];

					if (arr.length <= 1) {
						return;
					}
				}
			}

			function Bogosort(arr) {
				if (false === (this instanceof Bogosort)) {
					return new Bogosort(arr);
				}
				this.arr = arr;

				this.bogo = function() {
						this.sorted = true;
						for (var i = 0; i < this.arr.length - 1; i++) {
							queueDraw(this.arr.slice(), [i], []);
							if (this.arr[i] > this.arr[i + 1]) {
								this.sorted = false;
								break;
							}
						}

						if (this.sorted) {
							return true;
						}

						fisherYates(this.arr);
						return false;
				}

				this.bogoLoop = function() {
					var now = Date.now();
					while (Date.now() - now < 10) {
						if (this.bogo()) {
							return;
						}
					}

					setTimeout(this.bogoLoop, 1);
				}

				this.sort = function() {
					this.sorted = false;
					this.bogoLoop();
				}
			}
 
			sorts = {
				bubble: BubbleSort,
				selection: SelectionSort,
				insertion: InsertionSort,
				quick: Quicksort,
				bogo: Bogosort
			};

			begin(Quicksort, arrayGenerators.random(25), 100);
			// begin(InsertionSort, arrayGenerators.random(25), 100);
		});
	</script>
</body>
</html>
